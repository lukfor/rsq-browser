{{ title = "Genotyping Array Advisor" }}
{{include "layouts/header.view.html"}}

<div id="page-content">

    <div class="container">
    <h1>Genotyping Array Wizard</h1>

        <p>Please answer the following questions regarding your study population, data upload permissions, genes and SNPs of interest, and whether you have already genotyped your data. Based on your responses, we will suggest the most suitable genotyping array for your research needs.</p>

        <hr class="m-5">

        <div class="form-example-container">
            <!-- Form Section -->
            <div class="form-section">


            <form id="genotypingForm" action="{{routeUrl("reports_create",{})}}" method="post" enctype="multipart/form-data" onSubmit="waitDialog()">
            <!-- Population Selection -->
            <div class="form-group">
                <label for="population">What is the population of your study?</label>
                <select class="form-control" id="population" name="population" required>
                    <option value="" disabled selected>Select a population</option>
                    <option value="eur">European</option>
                    <option value="afr">African</option>
                    <option value="fin">Finnish</option>
                    <option value="his/lat">Hispanic/Latino</option>
                </select>
            </div>

            <!-- Data Upload Permission -->
            <div class="form-group">
                <label for="upload_permission">Is it allowed to upload data to an external server?</label>
                <select class="form-control" id="upload_permission" name="upload_permission" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="yes_europe">Yes, but the server has to be located in Europe</option>
                    <option value="no">No</option>
                </select>
            </div>

            <!-- Genotyped Data -->
            <div class="form-group">
                <label for="genotyped">Have you already genotyped your data?</label>
                <select class="form-control" id="genotyped" name="genotyped" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <!-- Chip Selection (Only shows if data is genotyped) -->
            <div class="form-group" id="chipSelection" style="display: none;">
                <label for="chip">Which genotyping chip was used?</label>
                <select class="form-control" id="chip" name="chip">
                    <option value="" disabled selected>Select a chip</option>
                    <option value="HC">Core</option>
                    <option value="OE">OmniExpress</option>
                    <option value="IO">Omni 2.5M</option>
                    <option value="MG">MEGA</option>
                </select>
            </div>


            <hr>

            <!-- Genes of Interest -->
            <div class="form-group">
                <label for="genesInput">Which genes are you interested in? (Enter one per line)</label>
                <textarea class="form-control" id="genesInput" name="genes" rows="5"></textarea>
            </div>

            <!-- SNPs of Interest -->
            <div class="form-group">
                <label for="snpsInput">Which SNPs are you interested in? (Enter one per line)</label>
                <textarea class="form-control" id="snpsInput" name="snps" rows="5"></textarea>
            </div>

            <hr>

            <!-- Rare Variant Analysis -->
            <div class="form-group">
                <label for="rare_variant_analysis">Do you need rare variant analysis?</label>
                <select class="form-control" id="rare_variant_analysis" name="rare_variant_analysis" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <hr>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary" id="submitButton" disabled>Submit</button>
        </form>
        </div>
            <!-- Examples Section -->
            <div class="examples-section">
                <h4>No data at hand? Try one of our examples</h4>

                <b>Breast Cancer Study:</b> Genetic factors, such as mutations in the BRCA1 and TP53 genes, are known to increase the risk of developing breast cancer. Understanding genetic variants and SNPs associated with breast cancer can provide insights into its susceptibility, diagnosis, and potential treatment options. Studies on rare variants can help identify novel genetic risk factors for more personalized medicine.
                <br><button type="button" class="btn btn-secondary ml-2" id="exampleButton">Fill Form</button>
                <hr>

                <p></p><b>Coronary Artery Disease (CAD) Study:</b> Key genes like LDLR (Low-Density Lipoprotein Receptor) and APOE (Apolipoprotein E) play a crucial role in lipid metabolism and cholesterol regulation, both of which are important in the development of CAD. Studying SNPs such as rs10455872 and rs1122608 can help researchers understand the genetic underpinnings of CAD and improve strategies for prevention, early detection, and treatment. Although rare variant analysis is often critical in other diseases, it may not always be necessary for CAD studies, as common variants may play a more significant role.</p>
                <p class="align-center"><button type="button" class="btn btn-secondary ml-2" id="cadExampleButton">Fill Form</button></p>
            </div>
        </div>
        </div>
</div>

<script>
    $(document).ready(function () {
           // Function to check form validity
           function checkFormValidity() {
               const population = $('#population').val();
               const uploadPermission = $('#upload_permission').val();
               const genes = $('#genesInput').val().trim();
               const snps = $('#snpsInput').val().trim();
               const rareVariantAnalysis = $('#rare_variant_analysis').val();
               const genotypedData = $('#genotyped').val();
               const chipSelect = $('#chip').val();

               // Enable submit if all required fields are filled
               if (population && uploadPermission && genes && snps && rareVariantAnalysis && genotypedData && (genotypedData === 'no' || chipSelect)) {
                   $('#submitButton').prop('disabled', false);
               } else {
                   $('#submitButton').prop('disabled', true);
               }
           }

           // Monitor changes and inputs
           $('#populationSelect, #uploadPermission, #rareVariantAnalysis, #genotypedData').change(checkFormValidity);
           $('#genesInput, #snpsInput').on('input', checkFormValidity);

           // Show chip selection if "Yes" for genotyped data
           $('#genotyped').change(function () {
               if ($(this).val() === 'yes') {
                   $('#chipSelection').show();
               } else {
                   $('#chipSelect').val('');
                   $('#chipSelection').hide();
               }

               // Trigger validation after changing genotypedData
               checkFormValidity();
           });

           // Example button functionality
           $('#exampleButton').click(function () {
               $('#population').val('eur');
               $('#upload_permission').val('yes');
               $('#genesInput').val('BRCA1\nTP53');
               $('#snpsInput').val('rs123456\nrs7891011');
               $('#rare_variant_analysis').val('yes');
               $('#genotyped').val('yes');
               $('#chip').val('IO'); // Omni 2.5M selected
               $('#chipSelection').show();

               // Trigger validation after filling example values
               checkFormValidity();
           });

             // Example button for CAD Study
           $('#cadExampleButton').click(function () {
               $('#population').val('eur');
               $('#upload_permission').val('yes');
               $('#genesInput').val('LDLR\nAPOE\nLPA');
               $('#snpsInput').val('rs10455872\nrs1122608');
               $('#rare_variant_analysis').val('no');
               $('#genotyped').val('no');
               $('#chip').val('');
               $('#chipSelection').hide();
               // Trigger validation after filling example values
               checkFormValidity();
           });
       });
</script>
{{include "layouts/footer.view.html"}}