<nav id="navigation" class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
  <a class="navbar-brand" href="{{routeUrl("index",{})}}">
    <div class="d-inline-block align-top" alt="">

    </div>
    Rsq Browser 2
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link {{isRouteActive("index") ? "active":""}}" href="{{routeUrl("index",{})}}">
          <i class="fas fa-search"></i> Search
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{isRouteActive("wizard") ? "active":""}}" href="{{routeUrl("wizard",{})}}">
        <i class="fas fa-magic"></i> Wizard
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="historyDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-clock"></i> Recent Reports
        </a>
        <div class="dropdown-menu" aria-labelledby="historyDropdown" id="recentUploadsMenu">
          <span class="dropdown-item">No reports available</span>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" id="clearHistoryButton">Clear History...</button>
        </div>
      </li>
    </ul>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link {{isRouteActive("download_list") ? "active":""}}" href="{{routeUrl("download_list",{})}}">
        <i class="fas fa-download"></i> Downloads
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://rsq-browser.readthedocs.io/" target="_blank">
          <i class="fas fa-book"></i> Documentation
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{isRouteActive("about") ? "active":""}}" href="{{routeUrl("about",{})}}" id="show-command-button">
          About
        </a>
      </li>
    </ul>
  </div>
</nav>


<script>
  function populateRecentUploads() {
    const recentUploadsString = localStorage.getItem('recent_uploads');
    const recentUploadsMenu = $('#recentUploadsMenu');

    // Clear existing items except the static ones (divider and clear button)
    recentUploadsMenu.children().not('.dropdown-divider, #clearHistoryButton').remove();

    if (recentUploadsString) {
      const recentUploads = JSON.parse(recentUploadsString);

      if (recentUploads.length > 0) {
        recentUploads.forEach((upload) => {
          const item = $('<a>', {
            class: 'dropdown-item',
            href: `/reports/${upload}`, // Adjust the href as necessary for your app
            text: `Report ${upload}`
          });
          recentUploadsMenu.prepend(item);
        });
      } else {
        recentUploadsMenu.prepend('<span class="dropdown-item">No reports available</span>');
      }
    } else {
      recentUploadsMenu.prepend('<span class="dropdown-item">No reports available</span>');
    }
  }

  // Clear history function
  function clearHistory() {
    bootbox.confirm({
      title: "Clear History",
      message: "Are you sure you want to clear all history? This action cannot be undone.",
      buttons: {
        confirm: {
          label: 'Yes',
          className: 'btn-danger'
        },
        cancel: {
          label: 'No',
          className: 'btn-secondary'
        }
      },
      callback: function (result) {
        if (result) {
          localStorage.removeItem('recent_uploads');
          populateRecentUploads();
        }
      }
    });
  }

  // Populate the dropdown dynamically when the user clicks on "History"
  $('#historyDropdown').on('click', populateRecentUploads);

  // Attach event listener to Clear History button
  $('#recentUploadsMenu').on('click', '#clearHistoryButton', clearHistory);
</script>